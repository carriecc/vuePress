---
tag: 
  - git
---

# Git 使用笔记

## HEAD^

`HEAD^`表示当前分支最新一次提交的第一个父节点，是`HEAD^1`的简写，`HEAD^2`以此类推。可以到达任何提交的父节点，而不仅仅是`HEAD`。

## git push

`-u`可以让 git 记住参数，下次推送的时候输入 git push 就可以了。

    git push -u <仓库名><分支名>
  
用于将本地分支的更新，推送到远程主机。
  
    git push <远程主机名> <本地分支名>:<远程分支名>

## git log

	git log <filename>

即可查看文件的修改记录。

	git log --grep=msg

查找含有 msg 关键字的 commit。

## git branch

列出所有远程分支

	git branch -r

列出所有分支，包括本地和远程

	git branch -a

新建一个本地分支并跟远程分支联系起来

	git checkout -b LocalName origin/remotebranchname

删除远程分支

	git push origin --delete remotebranchname

## git merge

1. 确认 HEAD 当前指向要接收合并的分支，`git checkout master`。
2. 确认接收分支跟合并分支是最新的。
3. `git merge <branch name>`，

git merge <分支名>：回到 master 分支后执行此命令，将分支合并到 master 上。

## git diff

Git 导出某两次提交之间的差异文件:

	git diff v${old_version} v${new_version} > ../${gitlab_version}.diff

查看工作环境与暂存区的差异

	git diff

暂存区域与你最后提交之间的差异

	git diff --staged

比较与最近一次提交的差异

	git diff HEAD

对比两个分支的差异部分

	git diff branch1 branch2 --stat

## git reset

本地有修改和提交，如何强制用远程的库更新(这样操作，之前所做的修改会被覆盖！！！谨慎使用！):

```
git fetch --all
git reset --hard origin/master(根据本地版本)
```

## git checkout

```
git checkout <sha1-of-a-commit> </path/to/your/file>: 
```

将文件恢复到某次提交的状态。

## git stash

即将更新下来的内容和本地修改的内容有冲突，先提交你的改变或者先将本地修改暂时存储起来。

1. 先将本地修改存储起来
`git stash`
2. pull内容
`git pull`
3. 还原暂存的内容
`git stash pop stash@{0}`
4. 解决文件中冲突的的部分

## git config

列出所有 Git 当时能找到的配置.

	git config --list

检查 Git 的某一项配置

	git config user.name

配置用户信息

	git config --global user.name "John Doe"
	git config --global user.email johndoe@example.com

## 撤回多个提交

假设提交历史如下：

	G1 - G2 - G3 - B1 - B2 - B3

其中 G1 - G3 都是“好”的提交而 B1 -B3 是坏的提交，需要撤回。

### git reset

第一个方法是回退提交，会重写提交历史，因此只有当提交还没有提交到服务器端的时候使用这个方法。`--hard`标志位会清空所有未提交的暂存。

	$ git reset --hard HEAD~3  # Careful, will remove not-commited changes

```
G1 - G2 - G3 - B1 - B2 - B3
           \    \    \    \-- HEAD
            \    \    \------ HEAD~1
             \    \---------- HEAD~2
              \-------------- HEAD~3
```

### git revert

如果修改已经推送到服务器端或者不想改变提交记录，最好是用`revert`。

`revert`命令拿到这些提交的 SHA1 并生成新的修改来撤回这些提交。

	$ git revert --no-commit HEAD~2^..HEAD

或者：

	$ git revert --no-commit HEAD~3..HEAD

由于需要撤回 B1 - B3。两个点`<rev1>..<rev2>`表示`(<rev1>, <rev2>]`间的提交。`--no-comit`表示让 git 撤回，但不要自动提交。最后得到了这样的提交历史：

	G1 - G2 - G3 - B1 - B2 - B3 - R`

其中``R`就是一个撤回提交会让仓库状态回退到`G3`。也可以由新到旧逐个指定提交：

	$ git revert --no-commit HEAD HEAD~1 HEAD~2

### 回退到某个版本

有时候只需要将仓库回退到某个版本而不需要逐个撤回。这对于想要撤回之前的合并点非常有用，因为用`git revert`需要指定 parent，会比较难做到，通常会看到`Commit XXX is a merge but no -m option was given.`的报错。

因此应该使用`git reset`。首先先硬复位到某个版本然后在软复位到当前状态。软复位会保留文件修改，因此它会将旧的状态带到当前状态：

```
# Careful, reset --hard will remove non-commited changes
$ git reset --hard 0682c06  # Use the SHA1 of the revision you want to revert to
HEAD is now at 0682c06 G3
$ git reset --soft HEAD@{1}
$ git commit -m "Reverting to the state of the project at 0682c06"
```

也可以用`git read-tree`的方法：

	git read-tree -um @ 0682c06  # Use the SHA1 of the revision you want to revert 

`-m`选项让`read-tree`合并指定状态而`-u`会用合并后的结果更新工作树

git fetch 下载远程的库的内容，不做任何的合并，git reset 把HEAD指向刚刚下载的最新的版本。

文件名应避免空格，否则使用 git rm 的时候要用双引号把文件名括起来（其中一种方法）。

## git remote

显示需要读写远程仓库使用的 Git 保存的简写与其对应的 URL

    git remote -v
    
添加远程仓库

    git remote add <shortname> <url>